<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Astrologer Link Generator</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <meta name="description" content="Generate shareable astrologer links with DOB, time, place, name, gender, and methodology."/>
</head>
<body class="min-h-screen bg-gradient-to-b from-slate-50 to-white text-slate-900">
  <main class="max-w-4xl mx-auto p-6">
    <header class="mb-8">
      <h1 class="text-3xl md:text-4xl font-bold tracking-tight">Astrologer Link Generator</h1>
      <p class="mt-2 text-slate-600">Enter birth details, pick a methodology, and get a shareable link. This page works fully offline (no server calls).</p>
    </header>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
      <!-- Form -->
      <section class="space-y-4 bg-white rounded-2xl shadow p-5">
        <h2 class="text-xl font-semibold">Birth Details</h2>

        <label class="block">
          <span class="text-sm text-slate-700">Full Name</span>
          <input id="name" class="mt-1 w-full rounded-xl border p-3" placeholder="e.g., Saurabh">
        </label>

        <div class="grid grid-cols-2 gap-4">
          <label class="block">
            <span class="text-sm text-slate-700">Gender</span>
            <select id="gender" class="mt-1 w-full rounded-xl border p-3">
              <option>Male</option>
              <option>Female</option>
              <option>Other</option>
              <option>Prefer not to say</option>
            </select>
          </label>

          <label class="block">
            <span class="text-sm text-slate-700">Methodology</span>
            <select id="method" class="mt-1 w-full rounded-xl border p-3">
              <option value="shailendra-jha">Shailendra Jha – Financial Astrology (PVNR-style)</option>
              <option value="pvnr-classic">P. V. N. Rao – Classic Jyotish</option>
              <option value="custom">Custom Saved Astrologer</option>
            </select>
          </label>
        </div>

        <label id="custom-wrap" class="block hidden">
          <span class="text-sm text-slate-700">Custom Methodology Code/Name</span>
          <input id="custom_method" class="mt-1 w-full rounded-xl border p-3" placeholder="e.g., shailendra-jha-v2">
        </label>

        <div class="grid grid-cols-2 gap-4">
          <label class="block">
            <span class="text-sm text-slate-700">Date of Birth</span>
            <input id="dob" type="date" class="mt-1 w-full rounded-xl border p-3">
          </label>
          <label class="block">
            <span class="text-sm text-slate-700">Time of Birth</span>
            <input id="tob" type="time" class="mt-1 w-full rounded-xl border p-3">
          </label>
        </div>

        <label class="block">
          <span class="text-sm text-slate-700">Place of Birth (City, State, Country)</span>
          <input id="place" class="mt-1 w-full rounded-xl border p-3" placeholder="e.g., Chanpatia, Bihar, India">
        </label>

        <div class="grid grid-cols-3 gap-4">
          <label class="block">
            <span class="text-sm text-slate-700">Timezone (optional)</span>
            <input id="tz" class="mt-1 w-full rounded-xl border p-3" placeholder="Asia/Kolkata or +05:30">
          </label>
          <label class="block">
            <span class="text-sm text-slate-700">Latitude (opt.)</span>
            <input id="lat" class="mt-1 w-full rounded-xl border p-3" placeholder="26.90" inputmode="decimal">
          </label>
          <label class="block">
            <span class="text-sm text-slate-700">Longitude (opt.)</span>
            <input id="lon" class="mt-1 w-full rounded-xl border p-3" placeholder="84.20" inputmode="decimal">
          </label>
        </div>

        <div class="flex flex-wrap gap-3 pt-2">
          <button id="btn-generate" class="rounded-2xl px-4 py-2 bg-slate-900 text-white shadow hover:opacity-90">Generate Link</button>
          <button id="btn-copy" class="rounded-2xl px-4 py-2 border shadow">Copy Link</button>
          <button id="btn-payload" class="rounded-2xl px-4 py-2 border shadow">Prepare Prediction Payload</button>
          <span id="copied" class="text-green-600 self-center hidden">Copied!</span>
        </div>
      </section>

      <!-- Output -->
      <section class="space-y-4">
        <div class="bg-white rounded-2xl shadow p-5">
          <h2 class="text-xl font-semibold">Shareable Link</h2>
          <p class="text-sm text-slate-600">Open or share this link to prefill these exact details anywhere this page is hosted.</p>
          <div id="linkbox" class="mt-3 p-3 rounded-xl border bg-slate-50 break-all text-sm min-h-[3rem]"></div>
          <div class="mt-3 flex gap-3">
            <a id="open-link" class="rounded-2xl px-4 py-2 bg-slate-900 text-white inline-block shadow" target="_blank" rel="noreferrer">Open Link</a>
          </div>
        </div>

        <div class="bg-white rounded-2xl shadow p-5">
          <h2 class="text-xl font-semibold">Prediction Engine Payload</h2>
          <p class="text-sm text-slate-600">This is the JSON you can send to your saved astrologer engine (e.g., PVNR/Shailendra Jha).</p>
          <div class="mt-3 p-3 rounded-xl border bg-slate-50 overflow-auto text-xs">
            <pre id="payloadbox" class="whitespace-pre-wrap">Click 'Prepare Prediction Payload' to generate.</pre>
          </div>
          <div class="mt-3 text-xs text-slate-600">
            <p class="font-medium">Implementation hint:</p>
            <ul class="list-disc pl-5 mt-1 space-y-1">
              <li>POST this payload to your serverless function or API route.</li>
              <li>Have your engine read <code>payload.method</code> to switch between PVNR/Shailendra-Jha/custom logic.</li>
            </ul>
          </div>
        </div>
      </section>
    </div>
  </main>

  <script>
    // Helpers
    function qs(id){ return document.getElementById(id); }
    function encode(v){ return encodeURIComponent(v || ""); }
    function combineDateTime(dateStr, timeStr){
      if(!dateStr){ return {local: "", iso: ""}; }
      const time = timeStr || "00:00";
      const local = dateStr + " " + time;
      let iso = "";
      try { iso = new Date(dateStr + "T" + time + ":00").toISOString(); } catch(e){}
      return {local, iso};
    }
    function setVisible(el, show){
      el.classList.toggle("hidden", !show);
    }

    // Elements
    const nameEl = qs("name");
    const genderEl = qs("gender");
    const dobEl = qs("dob");
    const tobEl = qs("tob");
    const placeEl = qs("place");
    const tzEl = qs("tz");
    const latEl = qs("lat");
    const lonEl = qs("lon");
    const methodEl = qs("method");
    const customWrap = qs("custom-wrap");
    const customMethodEl = qs("custom_method");

    const linkBox = qs("linkbox");
    const openLink = qs("open-link");
    const payloadBox = qs("payloadbox");
    const copied = qs("copied");

    const btnGen = qs("btn-generate");
    const btnCopy = qs("btn-copy");
    const btnPayload = qs("btn-payload");

    // Prefill from query params
    const params = new URLSearchParams(location.search);
    function get(k){ return params.get(k) || ""; }
    if(params.toString()){
      nameEl.value = get("name");
      genderEl.value = get("gender") || "Male";
      dobEl.value = get("dob");
      tobEl.value = get("tob");
      placeEl.value = get("place");
      tzEl.value = get("tz");
      latEl.value = get("lat");
      lonEl.value = get("lon");
      const m = get("method") || "shailendra-jha";
      methodEl.value = m;
      const cm = get("custom_method") || "";
      customMethodEl.value = cm;
      setVisible(customWrap, methodEl.value === "custom");
    }

    methodEl.addEventListener("change", () => {
      setVisible(customWrap, methodEl.value === "custom");
      generateLink();
    });

    [nameEl, genderEl, dobEl, tobEl, placeEl, tzEl, latEl, lonEl, customMethodEl].forEach(el => {
      el.addEventListener("input", () => {
        generateLink();
      });
    });

    function currentBase(){
      return location.origin + location.pathname.replace(/\/index\.html$/, "") + "index.html";
    }

    function generateLink(){
      const qs = new URLSearchParams();
      if(nameEl.value) qs.set("name", nameEl.value);
      if(genderEl.value) qs.set("gender", genderEl.value);
      if(dobEl.value) qs.set("dob", dobEl.value);
      if(tobEl.value) qs.set("tob", tobEl.value);
      if(placeEl.value) qs.set("place", placeEl.value);
      if(tzEl.value) qs.set("tz", tzEl.value);
      if(latEl.value) qs.set("lat", latEl.value);
      if(lonEl.value) qs.set("lon", lonEl.value);
      if(methodEl.value) qs.set("method", methodEl.value);
      if(customMethodEl.value && methodEl.value === "custom") qs.set("custom_method", customMethodEl.value);

      const href = currentBase() + "?" + qs.toString();
      linkBox.textContent = href;
      openLink.href = href;
      copied.classList.add("hidden");
    }

    function preparePayload(){
      const dt = combineDateTime(dobEl.value, tobEl.value);
      const payload = {
        name: nameEl.value || null,
        gender: genderEl.value || null,
        birth: {
          date: dobEl.value || null,
          time: tobEl.value || null,
          datetime_local: dt.local || null,
          datetime_iso: dt.iso || null,
          timezone: tzEl.value || null,
          lat: latEl.value ? Number(latEl.value) : null,
          lon: lonEl.value ? Number(lonEl.value) : null,
          place: placeEl.value || null,
        },
        method: methodEl.value === "custom" ? (customMethodEl.value || "custom") : methodEl.value,
        meta: {
          source: "Astrologer Link Generator v1",
          created_at: new Date().toISOString()
        }
      };
      payloadBox.textContent = JSON.stringify(payload, null, 2);
    }

    async function copyLink(){
      try {
        const text = linkBox.textContent.trim();
        if(!text){ generateLink(); }
        await navigator.clipboard.writeText(linkBox.textContent.trim());
        copied.classList.remove("hidden");
      } catch(e){
        copied.classList.add("hidden");
      }
    }

    btnGen.addEventListener("click", (e) => {
      e.preventDefault();
      generateLink();
    });

    btnCopy.addEventListener("click", (e) => {
      e.preventDefault();
      copyLink();
    });

    btnPayload.addEventListener("click", (e) => {
      e.preventDefault();
      preparePayload();
    });

    // Initialize
    generateLink();
  </script>
</body>
</html>
